<script>
	import {
		parsedStates,
		parsedCounties,
		parsedUSA,
		selectedState,
		selectedSecond,
		selectedCounty
	} from '$lib/stores.js';
	import getCategoryName from '$lib/utils/categoryLookup';
	import { format } from 'd3';

	let countyData = Object.entries(parsedCounties[$selectedCounty]).filter(function (d) {
		return d[0] !== 'county_state' && d[0] !== 'county' && d[0] !== 'state';
	});

	let usaData = Object.entries(parsedUSA).filter(function (d) {
		return d[0] !== 'name';
	});
</script>

<div class="flex flex-row w-full h-full">
	<div class="table">
		<div
			class="td border-b-navy border-b-2 text-sm font-bold text-center text-navy p-1 leading-tight align-baseline"
		>
			&nbsp
		</div>
		{#each Object.entries(parsedStates[$selectedState]) as col}
			<div class="tr">
				<div
					class="td border-b-[.5px] border-r-[.5px] border-gray text-sm text-center text-gray-dark align-middle break-words"
					style:font-weight={col[0] == $selectedSecond || col[0] == 'optimism' ? 'bold' : 'normal'}
				>
					{getCategoryName(col[0]).table}
				</div>
			</div>
		{/each}
	</div>
	<div class="table">
		<div
			class="td border-b-navy border-b-2 text-sm font-bold text-center text-navy p-1 leading-tight align-baseline"
		>
			State avg.
		</div>
		{#each Object.entries(parsedStates[$selectedState]) as col}
			{@const formatSecondValue = (d) =>
				col[0] == 'income' ? '$' + format(',')(format('.2f')(d)) : format(',')(format('.2f')(d))}
			<div class="tr">
				<div
					class="td border-b-[.5px] border-r-[.5px] border-gray text-sm text-center text-gray-dark align-middle break-words"
					style:font-weight={col[0] == $selectedSecond || col[0] == 'optimism' ? 'bold' : 'normal'}
				>
					{formatSecondValue(col[1])}
				</div>
			</div>
		{/each}
	</div>
	<div class="table">
		<div
			class="td border-b-navy border-b-2 text-sm font-bold text-center text-navy p-1 leading-tight align-baseline"
		>
			County avg.
		</div>
		{#each countyData as col}
			{@const formatSecondValue = (d) =>
				col[0] == 'income' ? '$' + format(',')(format('.2f')(d)) : format(',')(format('.2f')(d))}
			<div class="tr">
				<div
					class="td border-b-[.5px] border-r-[.5px] border-gray text-sm text-center text-gray-dark align-middle break-words"
					style:font-weight={col[0] == $selectedSecond || col[0] == 'optimism' ? 'bold' : 'normal'}
				>
					{col[1] == 'NA' ? 'Data unavailable' : formatSecondValue(col[1])}
				</div>
			</div>
		{/each}
	</div>
	<div class="table">
		<div
			class="td border-b-navy border-b-2 text-sm font-bold text-center text-navy p-1 leading-tight align-baseline"
		>
			U.S. avg.
		</div>
		{#each usaData as col}
			{@const formatSecondValue = (d) =>
				col[0] == 'income' ? '$' + format(',')(format('.2f')(d)) : format(',')(format('.2f')(d))}
			<div class="tr">
				<div
					class="td border-b-[.5px] border-gray text-sm text-center text-gray-dark align-middle break-words"
					style:font-weight={col[0] == $selectedSecond || col[0] == 'optimism' ? 'bold' : 'normal'}
				>
					{col[1] == 'NA' ? 'Data unavailable' : formatSecondValue(col[1])}
				</div>
			</div>
		{/each}
	</div>
</div>

<style>
	.table {
		display: table;
	}
	.tr {
		display: table-row;
	}
	.td {
		display: table-cell;
		padding: 5px;
	}
</style>
