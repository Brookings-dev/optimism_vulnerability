<script>
	import {
		parsedStates,
		parsedCounties,
		parsedUSA,
		selectedState,
		selectedSecond,
		selectedCounty
	} from '$lib/stores.js';
	import getCategoryName from '$lib/utils/categoryLookup';
	import { format } from 'd3';

	$: countyData =
		$selectedCounty !== null
			? Object.entries(parsedCounties[$selectedCounty]).filter(function (d) {
					return d[0] !== 'county_state' && d[0] !== 'county' && d[0] !== 'state';
			  })
			: ['', '', '', '', '', '', '', ''];

	let usaData = Object.entries(parsedUSA).filter(function (d) {
		return d[0] !== 'name';
	});
	let containerWidth;
	$: isMobile = containerWidth < 400;
</script>

<div bind:clientWidth={containerWidth} class="grid grid-cols-4 max-w-[500px] h-[450px] m-auto">
	<div class="table">
		<div class="table-title table-header sm:text-sm text-xs font-bold text-center text-navy">
			&nbsp;
		</div>
		{#each Object.entries(parsedStates[$selectedState]) as col}
			<div class="tr">
				<div
					class="table-col td sm:text-sm text-xs text-left text-gray-dark align-middle break-words"
					style:font-weight={col[0] == $selectedSecond || col[0] == 'optimism' ? 'bold' : 'normal'}
				>
					{!isMobile ? getCategoryName(col[0]).table : getCategoryName(col[0]).legend}
				</div>
			</div>
		{/each}
	</div>
	<div class="table">
		<div class="table-header table-title sm:text-sm text-xs font-bold text-center text-navy">
			State avg.
		</div>
		{#each Object.entries(parsedStates[$selectedState]) as col}
			{@const formatSecondValue = (d) =>
				col[0] == 'income' ? '$' + format(',')(format('.2f')(d)) : format(',')(format('.2f')(d))}
			<div class="tr">
				<div
					class="td table-col sm:text-sm text-xs text-center text-gray-dark align-middle break-words"
					style:font-weight={col[0] == $selectedSecond || col[0] == 'optimism' ? 'bold' : 'normal'}
				>
					{formatSecondValue(col[1])}
				</div>
			</div>
		{/each}
	</div>
	<div class="table">
		<div class="table-header table-title sm:text-sm text-xs font-bold text-center text-navy">
			County avg.
		</div>
		{#each countyData as col}
			{@const formatSecondValue = (d) =>
				col[0] == 'income' ? '$' + format(',')(format('.2f')(d)) : format(',')(format('.2f')(d))}
			<div class="tr">
				<div
					class="td table-col sm:text-sm text-xs text-center text-gray-dark align-middle break-words"
					style:font-weight={col[0] == $selectedSecond || col[0] == 'optimism' ? 'bold' : 'normal'}
				>
					{col[1] == 'NA'
						? 'Data unavailable'
						: col[1] == undefined
						? '-'
						: formatSecondValue(col[1])}
				</div>
			</div>
		{/each}
	</div>
	<div class="table">
		<div class="table-header table-title sm:text-sm text-xs font-bold text-center text-navy">
			U.S. avg.
		</div>
		{#each usaData as col}
			{@const formatSecondValue = (d) =>
				col[0] == 'income' ? '$' + format(',')(format('.2f')(d)) : format(',')(format('.2f')(d))}
			<div class="tr">
				<div
					class="td table-col-right sm:text-sm text-xs text-center text-gray-dark align-middle break-words"
					style:font-weight={col[0] == $selectedSecond || col[0] == 'optimism' ? 'bold' : 'normal'}
				>
					{col[1] == 'NA' ? 'Data unavailable' : formatSecondValue(col[1])}
				</div>
			</div>
		{/each}
	</div>
</div>

<style>
	.table-header {
		display: table-cell;
		height: 20px;
	}
	.table {
		display: table;
	}
	.tr {
		display: table-row;
	}
	.td {
		display: table-cell;
		padding-right: 2px;
		height: 36px;
	}
</style>
