<script>
	import { LayerCake, Svg, flatten } from 'layercake';
	import { stack } from 'd3-shape';
    import { scaleOrdinal } from 'd3-scale';
    import { format, precisionFixed } from 'd3-format';
    import { timeParse, timeFormat } from 'd3-time-format';

	import AreaStacked from '$lib/components/charts/furniture/AreaStacked.svelte';
	import AxisX from '$lib/components/charts/furniture/AxisX.svelte';
	import AxisY from '$lib/components/charts/furniture/AxisY.svelte';
	import Tooltip from '$lib/components/interactivity/Tooltip.svelte';

    import data from '$lib/data/dollar_searches_year.csv';

	let tooltip;
	let parentContainer;

    let currentCategory = "Restaurants";
	$: categoryData = data.filter(d => d.Category === currentCategory);

    const xKey = 'Year';
    const yKey = [0, 1];
    const zKey = 'key';

    const parseDate = timeParse('%Y');

    const seriesNames = ["$", "$$", "$$$", "$$$$"];
    const seriesColors = ['#398845', '#4BA51C', '#376B8A', '#0B2E4A'];

    /* --------------------------------------------
    * Create a stacked data structure
    */

    const stackData = stack()
        .keys(seriesNames);

    $: series = stackData(categoryData);

    $: console.log(series)
</script>

<div class="w-full" bind:this={parentContainer}>
	<figure class="m-0">
        <figcaption class="m-0 font-display font-bold text-base text-black">{currentCategory}</figcaption>
        <div class="w-full h-[600px]">
            <LayerCake
                padding={{ top: 0, right: 0, bottom: 0, left: 0 }}
                x={d => d.data[xKey]}
                y={yKey}
                z={zKey}
                zScale={scaleOrdinal()}
                zDomain={seriesNames}
                zRange={seriesColors}
                flatData={flatten(series)}
                data={series}
            >
                <Svg>
                    <AreaStacked />
                    <g>
                        <AxisX
                            baseline
                            gridlines={false}
                            snapTicks
                        />
                        <AxisY />
                    </g>
                </Svg>
            </LayerCake>
        </div>
    </figure>
	<!-- {#if !!tooltip}
		<Tooltip hidden={!!tooltip} {parentContainer}>
			<p class="my-0 text-base font-sans">
				{tooltip.detail.data.month}'s {tooltip.detail.data.variable} was {format('.2f')(
					tooltip.detail.data.value
				)}
			</p>
		</Tooltip>
	{/if} -->
</div>
