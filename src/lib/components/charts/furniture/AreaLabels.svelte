<!--
  @component
  Generates an SVG area shape using the `area` function from [d3-shape](https://github.com/d3/d3-shape) and sets the color via an ordinal scale in `zScale`. It assumes your data is in a [D3 stack format](https://github.com/d3/d3-shape#stack).
 -->
<script>
	import { getContext } from 'svelte';

	const { data, xDomain, xScale, yScale, width, height } = getContext('LayerCake');

	/** @type {Array} allXVals={["2019", "2020", "2021", "2022"]} - an array of all of the possible x values. */
	export let allXVals = $xDomain;

	/** @type {Array} xValsToShow={["2019", "2022"]} - the x values to create labels for. */
	export let xValsToShow = allXVals;

	/** @type {Function} [parseXVal=d => d] - A function that parses the x value to properly display using the xScale. */
	export let parseXVal = (d) => d;

	/** @type {Function} [formatLabel=d => d] - A function that passes the current label value and expects a nicely formatted value in return. */
	export let formatLabel = (d) => d;
</script>

<g>
	{#each $data as segment}
		{#each segment as [start, end], i}
			{@const textAnchor = i === 0 ? 'start' : i === allXVals.length - 1 ? 'end' : 'middle'}
			{@const xNudge = i === 0 ? 3 : i === allXVals.length - 1 ? -3 : 0}
			{@const hasLine = i !== 0 && i !== allXVals.length - 1}
			{@const yPos = (start + end) / 2}
			{@const yVal = end - start}
			{@const xVal = allXVals[i]}
			{@const show = xValsToShow.indexOf(xVal) > -1}
			{#if show}
				{#if hasLine}
					<line
						class="stroke-gray"
						y1={0}
						y2={$height}
						x1={$xScale(parseXVal(xVal))}
						x2={$xScale(parseXVal(xVal))}
					/>
				{/if}
				<text
					style="text-anchor: {textAnchor}"
					alignment-baseline="middle"
					class="fill-white text-xs font-sans font-thin"
					x={$xScale(parseXVal(xVal)) + xNudge}
					y={$yScale(yPos)}>{formatLabel(yVal)}</text
				>
			{/if}
		{/each}
	{/each}
</g>

<style>
	line {
		stroke-dasharray: var(--lineStrokeDashArray, 4);
		stroke-width: 0.5;
		stroke-opacity: 0.2;
	}
</style>
