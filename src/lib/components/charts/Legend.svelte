<script>
	export let legendBackground = 'white';
	export let stroke = '#000';
	export let firstColorArray = [];
	export let secondColorArray = [];
	export let firstLabel;
	export let secondLabel;
	export let firstMetricActive = true;
	export let colorScaleSize = 90;
	export let legendSize = 150;
	export let barLength = 90;
	export let barHeight = 30;

	let containerWidth;
	let isMobile;
	$: isMobile = containerWidth < 640;
</script>

<svelte:window />

<div
	bind:clientWidth={containerWidth}
	class="relative mobile:left-[79%] left-[60%] mobile:top-[50%] top-[50%]"
>
	<div
		style:background-color={legendBackground}
		class="absolute sm:left-[20px] left-[13px] sm:top-[20px] top-[12px]"
		style:transform="rotate(45deg)"
		style:width={!isMobile ? `${colorScaleSize}px` : `${colorScaleSize / 1.5}px`}
		style:height={!isMobile ? `${colorScaleSize}px` : `${colorScaleSize / 1.5}px`}
	>
		<div class="flex flex-col absolute">
			{#each firstColorArray as colorRect, i}
				<div
					style:background-color={colorRect}
					style:width={!isMobile ? `${barLength}px` : `${barLength / 1.5}px`}
					style:height={!isMobile ? `${barHeight}px` : `${barHeight / 1.5}px`}
					class="relative mix-blend-darken"
				/>
			{/each}
		</div>
		{#if firstMetricActive}
			<div class="flex flex-row absolute">
				{#each secondColorArray as colorRect, i}
					<div
						style:background-color={colorRect}
						style:width={!isMobile ? `${barHeight}px` : `${barHeight / 1.5}px`}
						style:height={!isMobile ? `${barLength}px` : `${barLength / 1.5}px`}
						class="relative mix-blend-darken"
					/>
				{/each}
			</div>
		{/if}
	</div>

	<div
		class="absolute"
		style:width={!isMobile ? `${legendSize}px` : `${legendSize / 1.5}px`}
		style:height={!isMobile ? `${legendSize}px` : `${legendSize / 1.5}px`}
		style:transform="rotate(45deg)"
	>
		<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400" class="absolute">
			<defs>
				<marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
					<polygon fill={stroke} points="0 0, 6 3.5, 0 7" />
				</marker>
			</defs>
			{#if firstMetricActive}
				<line
					x1="270"
					y1="345"
					x2="65"
					y2="345"
					{stroke}
					stroke-width="5"
					marker-end="url(#arrowhead)"
				/>
				<text x="110" y="390" class="legend-text">{firstLabel}</text>
			{/if}
			<line
				x1="305"
				y1="310"
				x2="305"
				y2="105"
				{stroke}
				stroke-width="5"
				marker-end="url(#arrowhead)"
			/>
			<text class="legend-text font-sans" x="0" y="375" transform="translate(-20, 315) rotate(270)"
				>{secondLabel}</text
			>
		</svg>
	</div>
</div>

<style>
	.legend-text {
		font-size: 2.25rem;
	}
</style>
